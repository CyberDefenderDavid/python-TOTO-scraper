<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Singapore Pools TOTO Results</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    h1 { color: #2e7d32; }
    label { margin-right: 0.5rem; }
    select { margin-right: 1rem; padding: 0.3rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 0.6rem; border: 1px solid #ccc; text-align: center; }
    th { background-color: #f0f0f0; }
    .section { margin-top: 2.5rem; }
    .pill {
      display: inline-block;
      padding: 8px 12px;
      margin: 4px;
      border-radius: 16px;
      font-size: 1rem;
      text-align: center;
      line-height: 1.3;
      border: 1px solid;
      position: relative;
    }
    .pill.hot {
      background-color: #ffebee;
      border-color: #f44336;
      color: #b71c1c;
    }
    .pill.cold {
      background-color: #e3f2fd;
      border-color: #2196f3;
      color: #0d47a1;
    }
    .hot-title { color: #d32f2f; font-weight: bold; }
    .cold-title { color: #1565c0; font-weight: bold; }
    .tooltip {
      visibility: hidden;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 4px;
      padding: 6px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.9rem;
      white-space: pre-line;
    }
    .pill:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
    .toggle-section {
      margin-top: 1rem;
    }
    .toggle-btn {
      cursor: pointer;
      color: #007BFF;
      text-decoration: underline;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      display: inline-block;
    }
    .hidden {
      display: none;
    }
    footer {
      margin-top: 4rem;
      font-size: 0.9rem;
      color: #666;
      border-top: 1px solid #ccc;
      padding-top: 1rem;
    }
  </style>
</head>
<body>

  <h1>TOTO Results</h1>

  <div>
    <label for="drawFilter">Filter by Draw Number:</label>
    <select id="drawFilter">
      <option value="all">All</option>
    </select>

    <label for="dateFilter">Filter by Date:</label>
    <select id="dateFilter">
      <option value="all">All</option>
    </select>
  </div>

  <table id="totoTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Draw Number</th>
        <th>Winning Numbers</th>
        <th>Additional Number</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="section">
    <h2>üé≤ TOTO Gen (Quick Pick)</h2>
    <button onclick="generateToto()">Generate Numbers</button>
    <p id="totoGenOutput"></p>
  </div>

  <div class="section">
    <h2 class="hot-title">üî• Hot Numbers (Most Drawn)</h2>

    <label for="bonusToggle">Include Additional Number:</label>
    <select id="bonusToggle">
      <option value="no" selected>No</option>
      <option value="yes">Yes</option>
    </select>

    <label for="hotCount">How many hot numbers to show:</label>
    <select id="hotCount">
      <option value="6" selected>6</option>
      <option value="7">7</option>
      <option value="8">8</option>
    </select>

    <p id="drawCount"></p>
    <div id="hotNumbers"></div>

    <h2 class="cold-title">‚ùÑÔ∏è Cold Numbers (Least Drawn)</h2>
    <div id="coldNumbers"></div>
  </div>

  <div class="section toggle-section">
    <span class="toggle-btn" onclick="toggleAllDraws()">Show All Numbers Based on Draw</span>
    <div id="allDraws" class="hidden">
      <ul id="allDrawList"></ul>
    </div>
  </div>

  <footer>
    <p>This site is an unofficial viewer of Singapore TOTO results.<br>
    Data is sourced from Singapore Pools and refreshed daily.<br>
    We are not affiliated with or endorsed by Singapore Pools.<br>
    This project is for learning GitHub Actions and workflow automation.</p>
  </footer>
  <script>
    let allData = [];
    let currentFiltered = [];

    fetch('toto_result.json')
      .then(response => response.json())
      .then(data => {
        allData = data;
        populateDropdowns(data);
        renderTable(data);
        currentFiltered = data;
        updateHotCold(data);
        renderAllDraws(data);
      })
      .catch(error => {
        console.error("Error loading TOTO results:", error);
      });

    function populateDropdowns(data) {
      const drawSet = new Set();
      const dateSet = new Set();

      data.forEach(r => {
        drawSet.add(r.draw_number);
        dateSet.add(r.date);
      });

      const drawFilter = document.getElementById('drawFilter');
      [...drawSet].sort().reverse().forEach(draw => {
        const option = document.createElement('option');
        option.value = draw;
        option.textContent = draw;
        drawFilter.appendChild(option);
      });

      const dateFilter = document.getElementById('dateFilter');
      [...dateSet].sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
        const option = document.createElement('option');
        option.value = date;
        option.textContent = date;
        dateFilter.appendChild(option);
      });

      drawFilter.addEventListener('change', applyFilters);
      dateFilter.addEventListener('change', applyFilters);
      document.getElementById('bonusToggle').addEventListener('change', () => updateHotCold(currentFiltered));
      document.getElementById('hotCount').addEventListener('change', () => updateHotCold(currentFiltered));
    }

    function applyFilters() {
      const draw = document.getElementById('drawFilter').value;
      const date = document.getElementById('dateFilter').value;

      let filtered = allData;

      if (draw !== "all") {
        filtered = filtered.filter(r => r.draw_number === draw);
      }

      if (date !== "all") {
        filtered = filtered.filter(r => r.date === date);
      }

      currentFiltered = filtered;
      renderTable(filtered);
      updateHotCold(filtered);
      renderAllDraws(filtered);
    }

    function renderTable(data) {
      const tbody = document.querySelector('#totoTable tbody');
      tbody.innerHTML = "";
      data.forEach(result => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${result.date}</td>
          <td>${result.draw_number}</td>
          <td>${result.winning_numbers.join(', ')}</td>
          <td>${result.additional_number}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function generateToto() {
      const numbers = new Set();
      while (numbers.size < 6) {
        numbers.add(Math.floor(Math.random() * 49) + 1);
      }
      const sorted = [...numbers].sort((a, b) => a - b);
      document.getElementById('totoGenOutput').textContent =
        "Your TOTO Numbers: " + sorted.join(', ');
    }

    function updateHotCold(data) {
      const includeBonus = document.getElementById('bonusToggle').value === "yes";
      const hotCountSetting = parseInt(document.getElementById('hotCount').value);

      const frequency = {};
      const appearances = {};

      for (let i = 1; i <= 49; i++) {
        frequency[i] = 0;
        appearances[i] = [];
      }

      data.forEach(draw => {
        draw.winning_numbers.forEach(num => {
          const n = parseInt(num, 10);
          if (!isNaN(n)) {
            frequency[n]++;
            appearances[n].push(draw.date);
          }
        });
        if (includeBonus) {
          const bonus = parseInt(draw.additional_number, 10);
          if (!isNaN(bonus)) {
            frequency[bonus]++;
            appearances[bonus].push(draw.date);
          }
        }
      });

      const entries = Object.entries(frequency)
        .map(([num, count]) => ({
          number: num,
          count: count,
          dates: appearances[num]
        }))
        .filter(x => x.count > 0);

      const sortedDesc = [...entries].sort((a, b) => b.count - a.count);
      const sortedAsc = [...entries].sort((a, b) => a.count - b.count);
      const avgCount = data.length / 49;

      const hot = sortedDesc.slice(0, hotCountSetting);
      const bottomCount = sortedAsc[0]?.count || 0;
      const cold = sortedAsc.filter(x =>
        x.count === bottomCount && !hot.find(h => h.number === x.number)
      );

      const format = (list, type) =>
        list.map(e =>
          `<span class="pill ${type}">
            <div>${e.count} draw${e.count > 1 ? "s" : ""}</div>
            <div>"${e.number}"</div>
            <span class="tooltip">${e.dates.join('\n')}</span>
          </span>`
        ).join('');

      document.getElementById('hotNumbers').innerHTML = format(hot, "hot");
      document.getElementById('coldNumbers').innerHTML = format(cold, "cold");
      document.getElementById('drawCount').textContent = `Results based on ${data.length} draw(s)`;
    }

    function toggleAllDraws() {
      const section = document.getElementById("allDraws");
      section.classList.toggle("hidden");
    }

    function renderAllDraws(data) {
      const ul = document.getElementById("allDrawList");
      ul.innerHTML = "";
      data.forEach(draw => {
        const li = document.createElement("li");
        li.textContent = `${draw.date} ‚Äî Draw ${draw.draw_number} ‚Üí ${draw.winning_numbers.join(', ')} + ${draw.additional_number}`;
        ul.appendChild(li);
      });
    }
  </script>
</body>
</html>
