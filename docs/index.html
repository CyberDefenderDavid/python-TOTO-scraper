<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Singapore Pools TOTO Results</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    h1 { color: #2e7d32; }
    label { margin-right: 0.5rem; }
    select { margin-right: 1rem; padding: 0.3rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 0.6rem; border: 1px solid #ccc; text-align: center; }
    th { background-color: #f0f0f0; }
    .section { margin-top: 2.5rem; }
    .pill {
      display: inline-block;
      padding: 8px 12px;
      margin: 4px;
      background-color: #e3f2fd;
      border-radius: 16px;
      font-size: 1rem;
      border: 1px solid #90caf9;
    }
    .hot-title { color: #d32f2f; font-weight: bold; }
    .cold-title { color: #1565c0; font-weight: bold; }
    #totoGenOutput { font-size: 1.3rem; margin-top: 1rem; color: #444; }
  </style>
</head>
<body>

  <h1>TOTO Results</h1>

  <div>
    <label for="drawFilter">Filter by Draw Number:</label>
    <select id="drawFilter">
      <option value="all">All</option>
    </select>

    <label for="dateFilter">Filter by Date:</label>
    <select id="dateFilter">
      <option value="all">All</option>
    </select>
  </div>

  <table id="totoTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Draw Number</th>
        <th>Winning Numbers</th>
        <th>Additional Number</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="section">
    <h2>üé≤ TOTO Gen (Quick Pick)</h2>
    <button onclick="generateToto()">Generate Numbers</button>
    <p id="totoGenOutput"></p>
  </div>

  <div class="section">
    <h2 class="hot-title">üî• Hot Numbers (Most Drawn)</h2>

    <label for="bonusToggle">Include Additional Number:</label>
    <select id="bonusToggle">
      <option value="no" selected>No</option>
      <option value="yes">Yes</option>
    </select>

    <label for="hotCount">How many hot numbers to show:</label>
    <select id="hotCount">
      <option value="6" selected>6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="all">All</option>
    </select>

    <p id="drawCount"></p>
    <div id="hotNumbers"></div>

    <h2 class="cold-title">‚ùÑÔ∏è Cold Numbers (Least Drawn)</h2>
    <div id="coldNumbers"></div>
  </div>

  <script>
    let allData = [];
    let currentFiltered = [];

    fetch('toto_result.json')
      .then(response => response.json())
      .then(data => {
        allData = data;
        populateDropdowns(data);
        renderTable(data);
        currentFiltered = data;
        updateHotCold(data);
      })
      .catch(error => {
        console.error("Error loading TOTO results:", error);
      });

    function populateDropdowns(data) {
      const drawSet = new Set();
      const dateSet = new Set();

      data.forEach(r => {
        drawSet.add(r.draw_number);
        dateSet.add(r.date);
      });

      const drawFilter = document.getElementById('drawFilter');
      [...drawSet].sort().reverse().forEach(draw => {
        const option = document.createElement('option');
        option.value = draw;
        option.textContent = draw;
        drawFilter.appendChild(option);
      });

      const dateFilter = document.getElementById('dateFilter');
      [...dateSet].sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
        const option = document.createElement('option');
        option.value = date;
        option.textContent = date;
        dateFilter.appendChild(option);
      });

      drawFilter.addEventListener('change', applyFilters);
      dateFilter.addEventListener('change', applyFilters);
      document.getElementById('bonusToggle').addEventListener('change', () => updateHotCold(currentFiltered));
      document.getElementById('hotCount').addEventListener('change', () => updateHotCold(currentFiltered));
    }

    function applyFilters() {
      const draw = document.getElementById('drawFilter').value;
      const date = document.getElementById('dateFilter').value;

      let filtered = allData;

      if (draw !== "all") {
        filtered = filtered.filter(r => r.draw_number === draw);
      }

      if (date !== "all") {
        filtered = filtered.filter(r => r.date === date);
      }

      currentFiltered = filtered;
      renderTable(filtered);
      updateHotCold(filtered);
    }

    function renderTable(data) {
      const tbody = document.querySelector('#totoTable tbody');
      tbody.innerHTML = "";
      if (data.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4'>No results found.</td></tr>";
        return;
      }
      data.forEach(result => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${result.date}</td>
          <td>${result.draw_number}</td>
          <td>${result.winning_numbers.join(', ')}</td>
          <td>${result.additional_number}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function generateToto() {
      const numbers = new Set();
      while (numbers.size < 6) {
        numbers.add(Math.floor(Math.random() * 49) + 1);
      }
      const sorted = [...numbers].sort((a, b) => a - b);
      document.getElementById('totoGenOutput').textContent =
        "Your TOTO Numbers: " + sorted.join(', ');
    }

    function updateHotCold(data) {
      const includeBonus = document.getElementById('bonusToggle').value === "yes";
      const hotCountSetting = document.getElementById('hotCount').value;

      const frequency = {};
      for (let i = 1; i <= 49; i++) frequency[i] = 0;

      data.forEach(draw => {
        draw.winning_numbers.forEach(num => {
          const n = parseInt(num, 10);
          if (!isNaN(n)) frequency[n]++;
        });
        if (includeBonus) {
          const bonus = parseInt(draw.additional_number, 10);
          if (!isNaN(bonus)) frequency[bonus]++;
        }
      });

      const entries = Object.entries(frequency)
        .map(([num, count]) => ({ number: num, count: count }))
        .filter(x => x.count > 0);

      const sortedDesc = [...entries].sort((a, b) => b.count - a.count);
      const sortedAsc = [...entries].sort((a, b) => a.count - b.count);

      let hot = [];
      if (hotCountSetting === "all") {
        hot = sortedDesc;
      } else {
        hot = sortedDesc.slice(0, parseInt(hotCountSetting));
      }

      const bottomCount = sortedAsc[0]?.count || 0;
      const cold = sortedAsc.filter(x => x.count === bottomCount);

      const format = list =>
        list.map(e => `<span class="pill">${e.number} ‚ñ∏ ${e.count} draw${e.count > 1 ? "s" : ""}</span>`).join('');

      document.getElementById('hotNumbers').innerHTML = format(hot);
      document.getElementById('coldNumbers').innerHTML = format(cold);
      document.getElementById('drawCount').textContent = `Results based on ${data.length} draw(s)`;
    }
  </script>

</body>
</html>
